# Packaging the `ai_software_dev_crew` CLI with PyInstaller

## Overview
This guide explains how to build a standalone executable for the **CrewAI** CLI (`ai_software_dev_crew`) using **PyInstaller**. The process works on macOS, Linux, and Windows.

## Prerequisites
- Python 3.10 – 3.13 installed.
- `pip` available.
- **PyInstaller** installed globally or in a virtual environment:
  ```bash
  pip install pyinstaller
  ```
- For Windows builds on a non‑Windows host you will need a Windows environment (VM, Docker with `wine`, or native Windows).

## Files Added
- `pyinstaller.spec` – PyInstaller spec file configured for onefile executable with all dependencies, hidden imports, and data files (prompts, templates, static assets).
- `scripts/package.sh` – Bash script for macOS/Linux.
- `scripts/package.bat` – Batch script for Windows.

## Building the Executable
### macOS / Linux
```bash
chmod +x scripts/package.sh
./scripts/package.sh
```
The script cleans previous builds, runs PyInstaller with the spec, and places the binary in `dist/ai_software_dev_crew`.

### Windows
```cmd
scripts\package.bat
```
The batch file performs the same steps and produces `dist\ai_software_dev_crew.exe`.

## Using the Executable
After a successful build, you can run the CLI directly:
```bash
./dist/ai_software_dev_crew --help
```
or on Windows:
```cmd
dist\ai_software_dev_crew.exe --help
```
All dependencies are bundled, so the target machine does **not** need a Python installation.

## Configuration Details

The `pyinstaller.spec` file is pre-configured with:
- ✅ **Onefile mode**: Creates a single standalone executable
- ✅ **Auto-detection**: PyInstaller automatically discovers most dependencies from your imports
- ✅ **Dynamic collection**: Uses `collect_all()` for packages with dynamic imports (crewai, flask, pydantic)
- ✅ **Data files**: Prompts, templates, static files, and config files are bundled
- ✅ **Exclusions**: Unnecessary modules (tkinter, matplotlib, IPython, etc.) are excluded to reduce size
- ✅ **UPX compression**: Enabled by default (can be disabled if issues occur)
- ✅ **Custom hooks**: Uses `hooks/` directory for maintainable module discovery

### Adding New Packages

When you add new dependencies:

1. **Most packages**: PyInstaller will auto-detect them from your imports - no changes needed!

2. **Packages with dynamic imports**: If a package uses `__import__()` or similar, add it to `pyinstaller.spec`:
   ```python
   new_pkg_datas, new_pkg_binaries, new_pkg_hiddenimports = collect_all('new_package')
   datas += new_pkg_datas
   hiddenimports += new_pkg_hiddenimports
   ```

3. **Missing imports at runtime**: If you get `ModuleNotFoundError` after building:
   - Check `build/pyinstaller/warn-pyinstaller.txt` for warnings
   - Add the missing module to `hiddenimports` in `pyinstaller.spec`
   - Or add it to `hooks/hook-ai_software_dev_crew.py` for project-wide modules

## Tips & Gotchas
- **Binary size**: The onefile executable can be large (≈ 50-100 MB) because it bundles Python, all dependencies, and data files. This is normal for PyInstaller onefile builds.
- **UPX**: PyInstaller uses UPX by default to compress binaries. If you encounter issues, disable it by setting `upx=False` in the spec file.
- **Cross‑compilation**: PyInstaller does **not** support building Windows binaries on macOS/Linux (or vice‑versa). Run the appropriate script on the target OS.
- **Missing modules**: If you get import errors at runtime, add the missing module to the `hiddenimports` list in `pyinstaller.spec`.
- **Data files**: Additional data files can be added to the `datas` list in `pyinstaller.spec` if needed.

## Verification
1. Run the generated binary with `--help` and confirm it exits with code 0.
2. Execute a simple command, e.g. `ai_software_dev_crew "Print version"`, and verify output.
3. (Optional) Use `ldd` (Linux) or `otool -L` (macOS) to check for missing shared libraries.

---
*Generated by Antigravity – your AI coding assistant.*
